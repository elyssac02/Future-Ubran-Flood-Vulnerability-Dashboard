////////////////////////////////////////////////////////////////////////////////
//////////////////////////////// JS Functions //////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

// Plotting inundation levels by year of FUTURES projection
function makeInundYearPlot(PlotID) {
    if(PlotID == "InundPlot_2025") {
      console.log("2025")
      title = "FUTURES 2025 km^2 Inundated of Developed Land"
      var class1 = {
          x:  [13, 14, 15, 16, 17],
          y:  [23255 * 0.0009, 23232 * 0.0009, 22295 * 0.0009, 23066 * 0.0009, 22155 * 0.0009],
          mode: 'lines+markers',
          name:"0.05 - 1 m",
          line: {
            color: '#99D1FE',
            width: 3
          }
      };
      var class2 = {
          x:  [13, 14, 15, 16, 17],
          y:  [80346 * 0.0009, 80194 * 0.0009, 81582 * 0.0009, 81695 * 0.0009, 83066 * 0.0009],
          mode: 'lines+markers',
          name:"1 - 5 m",
          line: {
            color: '#3986C3',
            width: 3
          }
      };
      var class3 = {
          x:  [13, 14, 15, 16, 17],
          y:  [3875 * 0.0009, 4121 * 0.0009, 5248 * 0.0009, 7109 * 0.0009, 11888 * 0.0009],
          mode: 'lines+markers',
          name:"> 5 m",
          line: {
            color: '#1B58F3',
            width: 3
          }
      };
    } else if (PlotID == "InundPlot_2030") {
      title = "FUTURES 2030 km^2 of Inundated Developed Land"
      console.log("2030")
      var class1 = {
          x:  [13, 14, 15, 16, 17],
          y:  [24131 * 0.0009, 24107 * 0.0009, 23161 * 0.0009, 23928 * 0.0009, 23007 * 0.0009],
          mode: 'lines+markers',
          name:"0.05 - 1 m",
          line: {
            color: '#99D1FE',
            width: 3
          }
      };
      var class2 = {
          x:  [13, 14, 15, 16, 17],
          y:  [84823 * 0.0009, 84615 * 0.0009, 85942 * 0.0009, 85842 * 0.0009, 87054 * 0.0009],
          mode: 'lines+markers',
          name:"1 - 5 m",
          line: {
            color: '#3986C3',
            width: 3
          }
      };
      var class3 = {
          x:  [13, 14, 15, 16, 17],
          y:  [4358 * 0.0009, 4663 * 0.0009, 5868 * 0.0009, 8008 * 0.0009, 13077 * 0.0009],
          mode: 'lines+markers',
          name:"> 5 m",
          line: {
            color: '#1B58F3',
            width: 3
          }
      };
    } else if (PlotID == "InundPlot_2035") {
      title = "FUTURES 2035 km^2 of Inundated Developed Land"
      console.log("2035")
      var class1 = {
          x:  [13, 14, 15, 16, 17],
          y:  [24982 * 0.0009, 24951 * 0.0009, 23982 * 0.0009, 24757 * 0.0009, 23806 * 0.0009],
          mode: 'lines+markers',
          name:"0.05 - 1 m",
          line: {
            color: '#99D1FE',
            width: 3
          }
      };
      var class2 = {
          x:  [13, 14, 15, 16, 17],
          y:  [88639 * 0.0009, 88378 * 0.0009, 89643 * 0.0009, 89296 * 0.0009, 90324 * 0.0009],
          mode: 'lines+markers',
          name:"1 - 5 m",
          line: {
            color: '#3986C3',
            width: 3
          }
      };
      var class3 = {
          x:  [13, 14, 15, 16, 17],
          y:  [4705 * 0.0009, 5069 * 0.0009, 6380 * 0.0009, 8823 * 0.0009, 14265 * 0.0009],
          mode: 'lines+markers',
          name:"> 5 m",
          line: {
            color: '#1B58F3',
            width: 3
          }
      };
    } else if (PlotID == "InundPlot_2038") {
      title = "FUTURES 2038 km^2 of Inundated Developed Land"
      console.log("2038")
      var class1 = {
          x:  [13, 14, 15, 16, 17],
          y:  [25510 * 0.0009, 25476 * 0.0009, 24515 * 0.0009, 25307 * 0.0009, 24326 * 0.0009],
          mode: 'lines+markers',
          name:"0.05 - 1 m",
          line: {
            color: '#99D1FE',
            width: 3
          }
      };
      var class2 = {
          x:  [13, 14, 15, 16, 17],
          y:  [90789 * 0.0009, 90525 * 0.0009, 91755 * 0.0009, 91275 * 0.0009, 92183 * 0.0009],
          mode: 'lines+markers',
          name:"1 - 5 m",
          line: {
            color: '#3986C3',
            width: 3
          }
      };
      var class3 = {
          x:  [13, 14, 15, 16, 17],
          y:  [4896 * 0.0009, 5266 * 0.0009, 6626 * 0.0009, 9236 * 0.0009, 14913 * 0.0009],
          mode: 'lines+markers',
          name:"> 5 m",
          line: {
            color: '#1B58F3',
            width: 3
          }
      };
    }
    var layout = {
      width: 600,
      height: 500,
      plot_bgcolor: '211F1F',
      paper_bgcolor: "211F1F",
      // yaxis: {range: [0, 100000]},
      margin: {
       b: 52,
       l: 80,
       r: 63,
       t: 57,
       pad: 0
     },
    title: {
        text: title,
        font: {
            family:"Arial",
            size:18,
            color: '#C5C5C5'
        }
    },
    xaxis:{
        title:{
            text: 'September, 2018 Day',
            font: {
                family:'Circular, monospace',
                size: 14,
                color: '#C5C5C5'
            }
        }
    },
    yaxis:{
        title:{
            text: 'km^2 of Developed Land',
            font: {
                family:'Circular, monospace',
                size: 14,
                color: '#C5C5C5'
            }
          },
          yaxis: {range: [0, 100000]},
        }
      };
    var data = [class1, class2, class3];
    Plotly.newPlot("InundByYear", data, layout);
}


// Plotting day of florence by inundation amount
function makeInundDayPlot(PlotID2) {
  if(PlotID2 == "Inund_0_1") {
    console.log(PlotID2)
    title = "FUTURES 0.05 - 1 m Inundation km^2 of Inundated Developed Land"
    var sept13 = {
        x:  [2025, 2030, 2035, 2038],
        y:  [23255 * 0.0009, 24131 * 0.0009, 24982 * 0.0009, 25510 * 0.0009],
        mode: 'lines+markers',
        name:"September 13",
        line: {
          color: '#90979C',
          width: 3
        }
    };
    var sept14 = {
        x:  [2025, 2030, 2035, 2038],
        y:  [23232 * 0.0009, 24107 * 0.0009, 24951 * 0.0009, 25476 * 0.0009],
        mode: 'lines+markers',
        name:"September 14",
        line: {
          color: '#ECECEC',
          width: 3
        }
    };
    var sept15 = {
      x:  [2025, 2030, 2035, 2038],
      y:  [22295 * 0.0009, 23161 * 0.0009, 23982 * 0.0009, 24515 * 0.0009],
      mode: 'lines+markers',
      name:"September 15",
      line: {
          color: '#99D1FE',
          width: 3
        }
    };
    var sept16 = {
      x:  [2025, 2030, 2035, 2038],
      y:  [23066 * 0.0009, 23928 * 0.0009, 24757 * 0.0009, 25307 * 0.0009],
      mode: 'lines+markers',
      name:"September 16",
      line: {
          color: '#3986C3',
          width: 3
        }
    };
    var sept17 = {
      x:  [2025, 2030, 2035, 2038],
      y:  [22155 * 0.0009, 23007 * 0.0009, 23806 * 0.0009, 24326 * 0.0009],
      mode: 'lines+markers',
      name:"September 17 (Peak Flood)",
      line: {
          color: '#1B58F3',
          width: 3
        }
    };
  } else if(PlotID2 == "Inund_1_5") {
      console.log("Inund2")
      title = "FUTURES 1 - 5 m Inundation km^2 of Inundated Developed Land"
      var sept13 = {
          x:  [2025, 2030, 2035, 2038],
          y:  [80346 * 0.0009, 84823 * 0.0009, 88639 * 0.0009, 90789 * 0.0009],
          mode: 'lines+markers',
          name:"September 13",
          line: {
            color: '#90979C',
            width: 3
          }
      };
      var sept14 = {
          x:  [2025, 2030, 2035, 2038],
          y:  [80194 * 0.0009, 84615 * 0.0009, 88378 * 0.0009, 90525 * 0.0009],
          mode: 'lines+markers',
          name:"September 14",
          line: {
            color: '#ECECEC',
            width: 3
          }
      };
      var sept15 = {
        x:  [2025, 2030, 2035, 2038],
        y:  [81582 * 0.0009, 85942 * 0.0009, 89643 * 0.0009, 91755 * 0.0009],
        mode: 'lines+markers',
        name:"September 15",
        line: {
            color: '#99D1FE',
            width: 3
          }
      };
      var sept16 = {
        x:  [2025, 2030, 2035, 2038],
        y:  [81695 * 0.0009, 85842 * 0.0009, 89296 * 0.0009, 91275 * 0.0009],
        mode: 'lines+markers',
        name:"September 16",
        line: {
            color: '#3986C3',
            width: 3
          }
      };
      var sept17 = {
        x:  [2025, 2030, 2035, 2038],
        y:  [83066 * 0.0009, 87054 * 0.0009, 90324 * 0.0009, 92183 * 0.0009],
        mode: 'lines+markers',
        name:"September 17 (Peak Flood)",
        line: {
            color: '#1B58F3',
            width: 3
          }
      };
  } else if(PlotID2 == "Inund_5") {
    console.log("Inund3")
    title = "FUTURES > 5 m Inundation km^2 of Inundated Developed Land"
    var sept13 = {
        x:  [2025, 2030, 2035, 2038],
        y:  [3875 * 0.0009, 4358 * 0.0009, 4705 * 0.0009, 4896 * 0.0009],
        mode: 'lines+markers',
        name:"September 13",
        line: {
          color: '#90979C',
          width: 3
        }
    };
    var sept14 = {
        x:  [2025, 2030, 2035, 2038],
        y:  [4121 * 0.0009, 4663 * 0.0009, 5069 * 0.0009, 5266 * 0.0009],
        mode: 'lines+markers',
        name:"September 14",
        line: {
          color: '#ECECEC',
          width: 3
        }
    };
    var sept15 = {
      x:  [2025, 2030, 2035, 2038],
      y:  [5248 * 0.0009, 5868 * 0.0009, 6380 * 0.0009, 6626 * 0.0009],
      mode: 'lines+markers',
      name:"September 15",
      line: {
          color: '#99D1FE',
          width: 3
        }
    };
    var sept16 = {
      x:  [2025, 2030, 2035, 2038],
      y:  [7109 * 0.0009, 8008 * 0.0009, 8823 * 0.0009, 9236 * 0.0009],
      mode: 'lines+markers',
      name:"September 16",
      line: {
          color: '#3986C3',
          width: 3
        }
    };
    var sept17 = {
      x:  [2025, 2030, 2035, 2038],
      y:  [11888 * 0.0009, 13077 * 0.0009, 14265 * 0.0009, 14913 * 0.0009],
      mode: 'lines+markers',
      name:"September 17 (Peak Flood)",
      line: {
          color: '#1B58F3',
          width: 3
        }
    };
  }
    var layout = {
      width: 700,
      height: 500,
      plot_bgcolor: '211F1F',
      paper_bgcolor: "211F1F",
      // yaxis: {range: [0, 100000]},
      margin: {
       b: 52,
       l: 80,
       r: 63,
       t: 57,
       pad: 0
     },
    title: {
        text: title,
        font: {
            family:"Arial",
            size:18,
            color: '#C5C5C5'
        }
    },
    xaxis:{
        title:{
            text: 'Year',
            font: {
                family:'Circular, monospace',
                size: 14,
                color: '#C5C5C5'
            }
        }
    },
    yaxis:{
        title:{
            text: 'km^2 of Inundated Developed Land',
            font: {
                family:'Circular, monospace',
                size: 14,
                color: '#C5C5C5'
            }
          },
          yaxis: {range: [0, 100000]},
        }
      };
  var data = [sept13, sept14, sept15, sept16, sept17];
  Plotly.newPlot("InundByDay", data, layout);
}

// Plotting FUTURES developed pixel projections
function makeDevelopProjPlot() {
  var trace = {
      x:  [2025, 2030, 2035, 2038],
      y:  [191074 * 0.0009, 199534 * 0.0009, 207446 * 0.0009, 212376 * 0.0009],
      mode: 'lines+markers',
      // fill: "tozeroy",
  };
  var layout = {
    // width: 500,
    // height: 400,
    plot_bgcolor: '211F1F',
    paper_bgcolor: "211F1F",
    margin: {
     b: 52,
     l: 80,
     r: 63,
     t: 57,
     pad: 0
   },
  title: {
      text:"FUTURES Projected km^2 of Developed Land",
      font: {
          family:"Arial",
          size:16,
          color: '#C5C5C5'
      }
  },
  xaxis:{
      title:{
          text: 'Year',
          font: {
              family:'Circular, monospace',
              size: 18,
              color: '#C5C5C5'
          }
      }
  },
  yaxis:{
      title:{
          text: 'Number of Developed Pixels',
          font: {
              family:'Circular, monospace',
              size: 18,
              color: '#C5C5C5'
          }
        }
      },
    };
  var data = [trace];
  Plotly.newPlot('ProjDev', data, layout);
}

function makeGLJSMap() {
  mapboxgl.accessToken = 'pk.eyJ1IjoiZWx5c3NhYyIsImEiOiJjazIxMm5zdXMxNGk5M2RxOGt5N3NxbTlwIn0.wmjEJHRLxSwFbJxa3Eh0VQ';
  var map = new mapboxgl.Map({
      container: 'map',
      zoom: 6,
      center: [-79.665535,35.707270],
      pitch: 45,
      style: 'mapbox://styles/mapbox/satellite-v9'
  });

  map.addControl(new mapboxgl.NavigationControl());

  map.on('load', function(){
      map.addSource('raster-tiles', {
          type: "raster",
          tiles: [
              "https://api.mapbox.com/v4/elyssac.cfkyprpn/8/{x}/{y}@2x.png?access_token=" + mapboxgl.accessToken
          ],
          tileSize: 256
      });

      map.addLayer({
          'id': 'FUTURES_2025',
          'type': 'raster',
          'source': 'raster-tiles'
      // The ID of an existing layer to insert the new layer before. If this argument is omitted, the layer will be inserted before every existing layer.
    })
  })
}

// Making leaflet interactive map
function makeLeafletMap() {
  var map = L.map('map').setView([34.26273, -78.15681], 9);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  })

  ////// Creating base layers
  var bLayer1 = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  });

  // ESRI baseMaps
  // Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels",
  // "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief",
  // "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"

  var bLayer2 = L.esri.basemapLayer('Topographic');
  var bLayer3 = L.esri.basemapLayer('NationalGeographic');
  var bLayer4 = L.esri.basemapLayer('ImageryFirefly').addTo(map);
  var bLayer5 = L.esri.basemapLayer('DarkGray');

  // Creating layers for flood tiles
  var sept13 = L.tileLayer.mbTiles('./images/sept13flood_tiles.mbtiles', {
    type: 'raster',
    minZoom: 0,
    maxZoom: 12,
    time: "September 13"
  });
  sept13.setOpacity(0.8)

  var sept14 = L.tileLayer.mbTiles('./images/sept14flood_tiles.mbtiles', {
    type: 'raster',
    minZoom: 0,
    maxZoom: 12,
    time: "September 14"
  });
  sept14.setOpacity(0.8)

  var sept15 = L.tileLayer.mbTiles('./images/sept15flood_tiles.mbtiles', {
    type: 'raster',
    minZoom: 0,
    maxZoom: 12,
    time: "September 15"
  });
  sept15.setOpacity(0.8)

  var sept16 = L.tileLayer.mbTiles('./images/sept16flood_tiles.mbtiles', {
    type: 'raster',
    minZoom: 0,
    maxZoom: 12,
    time: "September 16"
  });
  sept16.setOpacity(0.8)

  var sept17 = L.tileLayer.mbTiles('./images/sept17flood_tiles.mbtiles', {
    type: 'raster',
    minZoom: 0,
    maxZoom: 12,
    time: "September 17"
  });
  sept17.setOpacity(0.8)

  console.log(sept17)

  var vulnerability_change = L.tileLayer.mbTiles('./images/vulnerability_change_2025_2038.mbtiles', {
    type: 'raster',
    minZoom: 0,
    maxZoom: 12
  });

  // Creating layers for FUTURES tiles
  var f_ALL = L.tileLayer.mbTiles('./images/FUTURES_all_tiles.mbtiles', {
    type: 'raster',
    minZoom: 0,
    maxZoom: 12
  });

  var f_2025 = L.tileLayer.mbTiles('./images/FUTURES_2025_tiles.mbtiles', {
    type: 'raster',
    minZoom: 0,
    maxZoom: 12,
    time: "2025"
  }).addTo(map);

  var f_2030 = L.tileLayer.mbTiles('./images/FUTURES_2030_tiles.mbtiles', {
    type: 'raster',
    minZoom: 0,
    maxZoom: 12,
    time: "2030"
  });

  var f_2035 = L.tileLayer.mbTiles('./images/FUTURES_2035_tiles.mbtiles', {
    type: 'raster',
    minZoom: 0,
    maxZoom: 12,
    time: "2035"
  });

  var f_2038 = L.tileLayer.mbTiles('./images/FUTURES_2038_tiles.mbtiles', {
    type: 'raster',
    minZoom: 0,
    maxZoom: 12,
    time: "2038"
  });

  // Add HUC10
  // var hucStyle = {
  //     "color": "#7FBAE5",
  //     "weight": 5,
  //     "opacity": 0.5
  // };
  //
  // var huc10layer = $.ajax({
  //  url:'http://127.0.0.1:3000/SliderTest/images/HUC10_sub.geojson',
  //  dataType: "json",
  //  success: console.log("Data successfully loaded!"),
  //  error: function (xhr) {
  //     alert(xhr.statusText)
  //  }
  // })
  //
  // L.geoJSON(huc10layer.responseJSON).addTo(map);


  // $.ajax({
  //     type: "POST",
  //     url: 'http://127.0.0.1:3000/SliderTest/images/HUC10_sub.geojson',
  //     dataType: 'json',
  //     success: function (response) {
  //         huc10layer = L.geoJson(response, {
  //           style: hucStyle
  //         }).addTo(map);
  //         // map.fitBounds(geojsonLayer.getBounds());
  //     }
  // });


  // var huc10_sub = L.geoJSON('./images/HUC10_sub.geojson', {
  //     style: hucStyle
  // }).addTo(map);

  // console.log(huc10layer)
  // Creating map object with all tile layers
  // var map = L.map('map',{
  // center: [34.26273, -78.15681],
  // zoom: 9,
  // layers: [bLayer1, bLayer2, f_ALL, f_2025, f_2030, f_2035, f_2038, sept13, sept14, sept15, sept16, sept17]
  // });

  // var map = L.map('map',{
  // center: [34.26273, -78.15681],
  // zoom: 9,
  // layers: [bLayer1, bLayer2, f_ALL, sept13, sept14, sept15, sept16, sept17]
  // });


  // Creating baseMap layers
  // Add more
  var baseMaps = {
      "OSM": bLayer1,
      "Topographic": bLayer2,
      "National Geographic": bLayer3,
      "Firefly": bLayer4,
      "Dark Gray": bLayer5
  };

  // Create overlap map layers
  var overlayMaps = {
    // "Study Area": huc10layer,
      "FUTURES All Years": f_ALL,
      "FUTURES 2025": f_2025,
      "FUTURES 2030": f_2030,
      "FUTURES 2035": f_2035,
      "FUTURES 2038": f_2038,
      "September 13": sept13,
      "September 14": sept14,
      "September 15": sept15,
      "September 16": sept16,
      "September 17": sept17,
      "Vulnerability Change 2025 - 2038": vulnerability_change
    };

    // Add layers to map div
    L.control.layers(baseMaps, overlayMaps).addTo(map);

    // Flooding
    layerGroup_flooding = L.layerGroup([sept13, sept14, sept15, sept16, sept17]);
    var sliderControl_flooding = L.control.sliderControl({position: "topleft", layer: layerGroup_flooding, range: true, alwaysShowDate: true});
    map.addControl(sliderControl_flooding);
    sliderControl_flooding.startSlider();
}



////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////// jQuery /////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

// Call javascript code for changing button - FUTURES Inundation By Year Plots
$("#InundYearButtons :input").change(function() {
    ID_inundyear = $(this).attr('id')
    // console.log($(this).attr('id'));
    // console.log(ID);
    makeInundYearPlot(ID_inundyear);
});

// Call javascript code for changing button - FUTURES Inundation By Day/Amount Plots
$("#InundAmountButtons :input").change(function() {
    ID_dayamount = $(this).attr('id')
    // console.log($(this).attr('id'));
    // console.log(ID_dayamount);
    makeInundDayPlot(ID_dayamount);
});

// Call javascript code to load inital plots
$(document).ready(function() {
    console.log( "ready!" );
    ID_1 = "InundPlot_2025"
    ID_2 = "Inund_0_1"
    makeInundYearPlot(ID_1);
    makeInundDayPlot(ID_2);
    makeDevelopProjPlot();
    // makeGLJSMap();
    makeLeafletMap();
});
